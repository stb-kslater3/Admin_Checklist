<template>
    <div class="slds-align_absolute-center">
        <c-admin_search onadminchosen={handleAdminSelected}></c-admin_search>
    </div>


    <div class="slds-align_absolute-center slds-m-top_xx-large">
        <div class="slds-theme_shade slds-box slds-clearfix">
            <div class="slds-text-heading_large slds-align_absolute-center">
                Admin
            </div>

            <div class="slds-m-top_medium slds-align_absolute-center">
                <div class="slds-float_left slds-m-top_medium slds-box slds-box_xx-small">
                    <div class="slds-text-heading_medium slds-align_absolute-center">
                        Who, What, When
                    </div>

                    <div class="slds-align_absolute-center slds-m-top_xsmall">
                        <lightning-input type="text" label="Admin Name" data-id="whoWhat_AdminName" data-admin="true" data-apiname="Name__c" data-track="true">
                        </lightning-input>
                    </div>

                    <div class="slds-align_absolute-center slds-m-top_medium slds-m-bottom_medium">
                        Opportunity:
                        <lightning-formatted-url label="Not Set Yet" data-id="whoWhat_OpportunityLink" data-track="true"></lightning-formatted-url>
                    </div>

                    <div class="slds-clearfix slds-m-top_small">
                        <div class="slds-float_left slds-m-right_large">
                            <c-admin_userpicker
                                data-id="whoWhat_Salesman"
                                data-track="true"
                                data-admin="true"
                                data-apiname="Salesman__c"
                            >
                            </c-admin_userpicker>

                            <!--
                            <lightning-record-edit-form
                                object-api-name="AdminChecklist__c">

                                <lightning-input-field
                                    field-name="Salesman__c"
                                    data-id="whoWhat_Salesman" data-track="true"
                                    data-admin="true"
                                    data-apiname="Salesman__c">

                                </lightning-input-field>

                            </lightning-record-edit-form>
                            -->
                        </div>
    
                        <div class="slds-float_left">
                            <lightning-input label="Customer Name" data-id="whoWhat_Customer" data-admin="true" data-apiname="Customer_Name__c" data-track="true">
                            </lightning-input>
                        </div>
                    </div>

                    <div class="slds-align_absolute-center">
                        <lightning-input type="date" label="Date" data-id="whoWhat_Date" data-admin="true" data-apiname="Date__c" data-track="true">
                        </lightning-input>
                    </div>

    
                    <div class="slds-clearfix slds-m-top_medium">
                        <div class="slds-float_left slds-m-right_large">
                            <lightning-input label="Chassis Year" data-id="whoWhat_Chassis_Year" data-admin="true" data-apiname="Chassis_Year__c" data-track="true">
                            </lightning-input>

                            <lightning-input label="Chassis VIN" data-id="whoWhat_Chassis_VIN" data-admin="true" data-apiname="Chassis_VIN__c" data-track="true">
                            </lightning-input>
                        </div>
                        
                        <div class="slds-float_left slds-m-right_large">
                            <lightning-input label="Chassis Make" data-id="whoWhat_Chassis_Make" data-admin="true" data-apiname="Chassis_Make__c" data-track="true">
                            </lightning-input>

                            <lightning-input label="Chassis Model" data-id="whoWhat_Chassis_Model" data-admin="true" data-apiname="Chassis_Model__c" data-track="true">
                            </lightning-input>
                        </div>
                    </div>


                    <div class="slds-align_absolute-center slds-m-right_medium">
                        <lightning-input label="Body Series" data-id="whoWhat_Body_Series_Name" data-admin="true" data-apiname="Body_Series_Name__c" data-track="true">
                        </lightning-input>
                    </div>
                </div>
            </div>

            <div class="slds-m-top_medium slds-align_absolute-center">
                <div class="slds-float_left slds-m-top_medium slds-box slds-box_xx-small">
                    <div class="slds-m-bottom_small slds-text-heading_medium slds-align_absolute-center">
                        Approval
                    </div>

                    <div class="slds-m-top_small slds-clearfix">
                        <div class="slds-align_absolute-center">
                            <lightning-input label="Manager Name" data-id="ManagerName" data-admin="true" data-apiname="ManagerName__c" data-track="true">
                            </lightning-input>   
                        </div>

                        <div class="slds-align_absolute-center">
                            <lightning-input type="date" label="Date of Approval" data-id="DateOfApproval" data-admin="true" data-apiname="DateOfApproval__c" data-track="true">
                            </lightning-input>
                        </div>
                    </div>
                </div>
            </div>

            <div class="slds-m-top_large slds-box slds-box_xx-small slds-clearfix">
                <div class="slds-m-bottom_small slds-text-heading_medium slds-align_absolute-center">
                    Notes
                </div>

                <div class="slds-m-top_small">
                    <lightning-textarea label="Notes and Special Instructions" data-id="Notes" data-admin="true" data-apiname="Notes__c" data-track="true">
                    </lightning-textarea>
                </div>
            </div>

            <div class="slds-m-top_large slds-clearfix slds-box slds-box_xx-small">
                <div class="slds-m-bottom_small slds-text-heading_medium slds-align_absolute-center">
                    Finances
                </div>

                <div class="slds-float_left slds-m-top_medium">
                    <div style="max-height: 500px" class="slds-scrollable_y slds-box slds-box-xx_small slds-theme_default">
                        <div>
                            <template for:each={poDynamicList} for:item="poDynamic">
                                <div key={poDynamic.index} class=" slds-clearfix slds-m-bottom_small slds-box slds-box-xx_small slds-theme_shade">
                                    <div class="slds-align_absolute-center">
                                        <lightning-formatted-text data-id={poDynamic.dataIdType} value={poDynamic.type} data-adminpo="true" data-apiname="Type__c" data-apiid={poDynamic.apiId} data-track="true" data-index={poDynamic.index}>
                                        </lightning-formatted-text>
                                    </div>

                                    <div class="slds-align_absolute-center">
                                        <lightning-input type="number" formatter="currency" step=".01" label="Cost" data-id={poDynamic.dataIdCost} value={poDynamic.cost} data-adminpo="true" data-apiname="Cost__c" data-apiid={poDynamic.apiId} data-track="true" data-isnumber="true" data-index={poDynamic.index} disabled={poDynamic.disabled} onfocusout={handleModifyFinances}>
                                        </lightning-input>
                                    </div>

                                    <div class="slds-align_absolute-center">
                                        <lightning-textarea label="Description" data-id={poDynamic.dataIdDescription} value={poDynamic.description} data-adminpo="true" data-apiname="Description__c"  data-apiid={poDynamic.apiId} data-track="true" data-index={poDynamic.index}>
                                        </lightning-textarea>
                                    </div>

                                    <div class="slds-align_absolute-center">
                                        {poDynamic.lineDescription}
                                    </div>

                                    <div class="slds-align_absolute-center">
                                        <lightning-button
                                            variant="brand"
                                            label="Remove"
                                            onclick={handleClick_RemovePO}
                                            data-id={poDynamic.dataIdRemoveButton}
                                            data-index={poDynamic.index}
                                            hidden={poDynamic.disabled}>
                                        </lightning-button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>


                    <div class="slds-m-top_medium slds-clearfix slds-m-bottom_small slds-box slds-box-xx_small">
                        <div>
                            <lightning-combobox label="Type" data-id="AddPOType" data-track="true" options={typeOptions}>
                            </lightning-combobox>
                        </div>

                        <div>
                            <lightning-input type="number" formatter="currency" step=".01" label="Cost" data-id="AddPOCost" data-track="true">
                            </lightning-input>
                        </div>

                        <div>
                            <lightning-textarea label="Description" data-id="AddPODescription" data-track="true">
                            </lightning-textarea>
                        </div>

                        <div class="slds-align_absolute-center">
                            <lightning-button
                                variant="brand"
                                label="Add PO Line"
                                onclick={handleClick_AddPO}>
                            </lightning-button>
                        </div>
                    </div>
                </div>


                <div class="slds-float_left slds-m-top_medium slds-m-left_medium slds-border_left">
                    <div class="slds-clearfix">
                        <div class="slds-m-left_small">
                            <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                                PO Subtotal:
                            </div>

                            <b style="color: green;">
                                <lightning-formatted-number format-style="currency" currency-code="USD" data-id="finances_POSubtotal" data-track="true">
                                </lightning-formatted-number>
                            </b>
                        </div>
                    </div>

                    <div class="slds-m-left_small">
                        <lightning-input type="number" formatter="currency" step=".01" label="Profit Amount" data-id="finances_Profit_Amount" data-admin="true" data-isnumber="true" data-apiname="Profit_Amount__c" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>

                    <div class="slds-m-left_small slds-m-top_xx_small">
                        <div class="slds-m-top_xx-small">
                            <lightning-input type="number" label="Profit %:" formatter="percent" step=".0001" data-id="finances_Profit_Percent" data-track="true" onfocusout={handleModifyProfitPercent}>
                            </lightning-input>
                        </div>
                    </div>


                    <div class="slds-m-left_small slds-m-top_small">
                        <lightning-input type="number" formatter="currency" step=".01" label="Dealer Pack" data-id="finances_Dealer_Pack" data-admin="true" data-isnumber="true" data-apiname="Dealer_Pack__c" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>

                    <div class="slds-m-left_small slds-m-top_xx-small">
                        <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                            Gross After Comission:
                        </div>

                        <b style="color: green;">
                            <lightning-formatted-number format-style="currency" currency-code="USD" data-id="finances_Gross_Amount" data-track="true">
                            </lightning-formatted-number>
                        </b>
                    </div>

                    <div class="slds-m-left_small slds-m-top_xx_small">
                        <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                            Gross After Comission %:
                        </div>
                        
                        <b style="color: blue;">
                            <lightning-formatted-number format-style="percent" maximum-fraction-digits="2" data-id="finances_Gross_Percent" data-track="true">
                            </lightning-formatted-number>
                        </b>
                    </div>


                    <div class="slds-m-left_small slds-m-top_medium slds-clearfix">
                        <lightning-helptext class="slds-float_left slds-m-right_xx-small" content="Subtotal after profit is the sum of all the Costs/PO's with the Profit_Amount. It is the official Sales Price before Fees are applied, and is used to determine the 12% F.E.T."></lightning-helptext>

                        <div class="slds-float_left slds-m-top_xx-small">
                            <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                                Subtotal After Profit:
                            </div>

                            <b style="color: green;">
                                <lightning-formatted-number format-style="currency" currency-code="USD" data-id="finances_Subtotal_After_Profit" data-track="true">
                                </lightning-formatted-number>
                            </b>
                        </div>
                    </div>
                </div>

                <div class="slds-float_left slds-m-top_medium slds-m-left_medium slds-border_left">
                    <div class="slds-m-left_small">
                        <lightning-input
                            type="checkbox"
                            label="Apply F.E.T."
                            data-id="finances_FET_Checkbox"
                            data-admin="true"
                            data-apiname="ApplyFET__c"
                            data-track="true"
                            onclick={handleModifyFinances}>
                        </lightning-input>
                    </div>

                    <div class="slds-m-left_small slds-m-top_xx-small slds-clearfix">
                        <lightning-helptext class="slds-float_left slds-m-right_xx-small" content="12% of the Subtotal is the Federal Excise Tax (F.E.T.) amount applied"></lightning-helptext>

                        <div class="slds-float_left slds-m-top_xx-small">
                            <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                                12% F.E.T.:
                            </div>

                            <b style="color: green;">
                                <lightning-formatted-number format-style="currency" currency-code="USD" data-id="finances_12_FET" data-track="true">
                                </lightning-formatted-number>
                            </b>
                        </div>
                    </div>

                    <div class="slds-m-left_small slds-m-top_xx-small">
                        <lightning-input type="number" formatter="currency" step=".01" label="Minus Tire F.E.T." data-id="finances_Minus_Tire_FET" data-admin="true" data-isnumber="true" data-apiname="Minus_Tire_FET__c" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>

                    <div class="slds-m-left_small slds-m-top_xx-small">
                        <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                            Total F.E.T.:
                        </div>

                        <b style="color: green;">
                            <lightning-formatted-number format-style="currency" currency-code="USD" data-id="finances_Total_FET" data-track="true">
                            </lightning-formatted-number>
                        </b>
                    </div>


                    <div class="slds-m-left_small slds-m-top_small">
                        <lightning-input type="number" formatter="currency" step=".01" label="Extended Warranty" data-id="finances_Extended_Warranty" data-admin="true" data-isnumber="true" data-apiname="Extended_Warranty__c" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>

                    <div class="slds-m-left_small slds-m-top_small">
                        <lightning-input type="number" formatter="currency" step=".01" label="Other Fees" data-id="finances_Other_Fees" data-admin="true" data-apiname="Other_Fees__c" data-isnumber="true" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>


                    <div class="slds-m-left_small slds-m-top_small">
                        <lightning-input type="number" formatter="currency" step=".01" label="Documentation Fee" data-id="finances_Documentation_Fee" data-admin="true" data-apiname="Documentation_Fee__c" data-isnumber="true" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>


                    <div class="slds-m-left_small slds-m-top_small">
                        <lightning-helptext class="slds-float_left" content="Sum of Deposit and Net Trade Allowance">
                        </lightning-helptext>

                        <lightning-input type="number" formatter="currency" step=".01" label="Deposit" data-id="finances_Deposit" data-admin="true" data-apiname="Deposit__c" data-isnumber="true" data-track="true" onfocusout={handleModifyFinances}>
                        </lightning-input>
                    </div>


                    <div class="slds-m-left_small slds-m-top_medium slds-clearfix">
                        <lightning-helptext class="slds-float_left slds-m-right_xx-small" content="Sum of the Subtotal, Total F.E.T., Fees, etc. minus the Deposit and the Trade In Billing Amount. The Trade In Billing Amount is the amount of the Trade In credited toward this Sale."></lightning-helptext>

                        <div class="slds-float_left slds-m-top_xx-small">
                            <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                                Total:
                            </div>

                            <b style="color: green;">
                                <lightning-formatted-number format-style="currency" currency-code="USD" data-id="finances_Total" data-track="true">
                                </lightning-formatted-number>
                            </b>
                        </div>
                    </div>
                </div>
            </div>


            <div class="slds-m-top_large slds-clearfix slds-align_absolute-center">
                <div>
                    <div class="slds-float_left slds-m-right_medium slds-m-top_small">
                        <lightning-button
                            variant="brand"
                            label="Save"
                            onclick={handleClick_SaveQuote}>
                        </lightning-button>
                    </div>
    
                    <div class="slds-float_left slds-m-right_medium slds-m-top_small">
                        <lightning-button
                            variant="brand"
                            label="Download"
                            onclick={handleClick_PrintQuote}>
                        </lightning-button>
                    </div>

                    <div class="slds-float_left slds-m-right_medium slds-m-top_small">
                        <lightning-button
                            variant="brand"
                            label="Snapshot"
                            onclick={handleClick_Snapshot}>
                        </lightning-button>
                    </div>
                </div>
            </div>


            <div class="slds-align_absolute-center slds-m-top_medium">
                <!-- Apparently not reactive because asynchronous timing of when adminChosen is set so give it a data-id and track it so that you can set it manually within handle admin chosen when the admin will actually be known -->
                <c-admin_snapshots data-id="Snapshots" data-track="true">
                </c-admin_snapshots>
            </div>


            <div class="slds-align_absolute-center">
                <div class="slds-float_left slds-m-top_large slds-box slds-box_xx-small">
                    <div class="slds-m-bottom_small slds-text-heading_medium slds-align_absolute-center">
                        Trade In
                    </div>
    
                    <div class="slds-clearfix">
                        <div class="slds-float_left slds-m-right_large">
                            <lightning-input label="Trade In Make" data-admin="true" data-apiname="TradeIn_Make__c" data-id="tradeIn_Make" data-track="true">
                            </lightning-input>
                        
                            <lightning-input label="Trade In Model" data-id="tradeIn_Model" data-admin="true" data-apiname="TradeIn_Model__c" data-track="true">
                            </lightning-input>
                        </div>
                    
                        <div class="slds-float_left">
                            <lightning-input label="Trade In Year" data-id="tradeIn_Year" data-admin="true" data-apiname="TradeIn_Year__c"  data-track="true">
                            </lightning-input>
                        </div>
                    </div>
    
                    <div>
                        <div>
                            <lightning-input label="Trade In Unit Number" data-id="tradeIn_Unit_Number" data-admin="true" data-apiname="TradeIn_Unit_Number__c" data-track="true">
                            </lightning-input>
                        </div>
                    </div>
    
    
                    <div class="slds-clearfix">
                        <div class="slds-float_left slds-m-right_large">
                            <lightning-input type="number" formatter="currency" step=".01" label="Actual Cash Value" data-id="tradeIn_Actual_Cash_Value" data-admin="true" data-apiname="TradeIn_Actual_Cash_Value__c" data-isnumber="true" data-track="true">
                            </lightning-input>
                        </div>
    
                        <div class="slds-float_left slds-m-right_large">
                            <lightning-input type="number" formatter="currency" step=".01" label="Trade In Billing Amount" data-id="tradeIn_Billing_Amount" data-admin="true" data-apiname="TradeIn_Billing_Amount__c" data-isnumber="true" data-track="true">
                            </lightning-input>

                            <lightning-input type="number" formatter="currency" step=".01" label="Payoff Remaining" data-id="tradeIn_Payoff" data-admin="true" data-apiname="TradeIn_Payoff__c" data-isnumber="true" data-track="true">
                            </lightning-input>
                        </div>
                    </div>
                </div>
            </div>


            <div class="slds-align_absolute-center">
                <div class="slds-float_left slds-m-top_large slds-box slds-box_xx-small">
                    <div class="slds-text-heading_medium slds-align_absolute-center">
                        F.E.T. Tire Tax Credits
                    </div>
    
    
                    <div class="slds-clearfix">
                        <div class="slds-float_left slds-m-right_large slds-m-top_medium">
                            <div class="slds-m-bottom_small slds-text-body-small slds-align_absolute-center">
                                Front Tires
                            </div>
    
                            <div>
                                <lightning-input label="Front Tire Description" data-id="fetCredit_FET_Front_Description" data-admin="true" data-apiname="FET_Front_Description__c" data-track="true">
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-top_small">
                                <lightning-input label="Front Tire Size" data-id="fetCredit_FET_Front_Size" data-admin="true" data-apiname="FET_Front_Size__c" data-track="true">
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-top_small">
                                <lightning-input type="number" formatter="currency" step=".01" label="Front Tire Cost" data-id="fetCredit_FET_Front_Cost" data-admin="true" data-apiname="FET_Front_Cost__c" data-isnumber="true" data-track="true" onfocusout={calculateFETTotals}>
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-top_small">
                                <lightning-input type="number" label="Front Tire Quantity" data-id="fetCredit_FET_Front_Quantity" data-admin="true" data-apiname="FET_Front_Quantity__c" data-isnumber="true" data-track="true" onfocusout={calculateFETTotals}>
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-left_small slds-m-top_small">
                                <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                                    Subtotal:
                                </div>
    
                                <b style="color: green;">
                                    <lightning-formatted-number format-style="currency" currency-code="USD" data-id="fetCredit_FET_Front_Subtotal" data-track="true">
                                    </lightning-formatted-number>
                                </b>
                            </div>
                        </div>
    
                        <div class="slds-float_left slds-m-top_medium">
                            <div class="slds-m-bottom_small slds-text-body-small slds-align_absolute-center">
                                Rear Tires
                            </div>
    
                            <div>
                                <lightning-input label="Rear Tire Description" data-id="fetCredit_FET_Rear_Description" data-admin="true" data-apiname="FET_Rear_Description__c" data-track="true">
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-top_small">
                                <lightning-input label="Rear Tire Size" data-id="fetCredit_FET_Rear_Size" data-admin="true" data-apiname="FET_Rear_Size__c" data-track="true">
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-top_small">
                                <lightning-input type="number" formatter="currency" step=".01" label="Rear Tire Cost" data-id="fetCredit_FET_Rear_Cost" data-admin="true" data-apiname="FET_Rear_Cost__c" data-isnumber="true" data-track="true" onfocusout={calculateFETTotals}>
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-top_small">
                                <lightning-input type="number" label="Rear Tire Quantity" data-id="fetCredit_FET_Rear_Quantity" data-admin="true" data-apiname="FET_Rear_Quantity__c" data-isnumber="true" data-track="true" onfocusout={calculateFETTotals}>
                                </lightning-input>
                            </div>
    
                            <div class="slds-m-left_small slds-m-top_small">
                                <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                                    Subtotal:
                                </div>
    
                                <b style="color: green;">
                                    <lightning-formatted-number format-style="currency" currency-code="USD" data-id="fetCredit_FET_Rear_Subtotal" data-track="true">
                                    </lightning-formatted-number>
                                </b>
                            </div>
                        </div>
                    </div>
    
    
                    <div class="slds-m-top_medium slds-align_absolute-center">
                        <div class="slds-m-right_xx-small slds-float_left slds-text-body_small">
                            Total:
                        </div>
    
                        <b style="color: green;">
                            <lightning-formatted-number format-style="currency" currency-code="USD" data-id="fetCredit_FET_Total" data-track="true">
                            </lightning-formatted-number>
                        </b>
                    </div>
                </div>
            </div>
        </div>

    </div>
</template>